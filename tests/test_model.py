import pdb

import pickle
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker

from setting.parameter import SQLALCHEMY_DIR
from GUI.model.relationmodel import Base,Account,ResultContext,CVResult,OPResult
import logging

logger = logging.getLogger(__name__)


def test_create_relation_model():
    SQLALCHEMY_DIR = "sqlite:///setting/test_relation_result.db"
    engine = create_engine(SQLALCHEMY_DIR)
    Base.metadata.create_all(engine)

    logger.warning("creat db by " + SQLALCHEMY_DIR)
    # DBSession.create
    # pdb.set_trace()


def test_insert_cvresult():
    SQLALCHEMY_DIR = "sqlite:///setting/test_relation_result.db"
    engine = create_engine(SQLALCHEMY_DIR)
    Session = sessionmaker(bind=engine)
    session = Session()
    # pdb.set_trace()
    user = session.query(Account).filter_by(name='lidingke').one()
    print "user:",user

    context = ResultContext(
        sharpindex= 123,
        fiber_type='G652',
        fiber_producer='YOFC',
        fiber_number='ABC',
        fiber_length=2,
        instrument='abc',
        worker=user.id
    )
    session.add(context)
    session.commit()

    cvresult = CVResult(
        corediameter=9,
        claddiameter=125,
        coreroundness=0.1,
        cladroundness=0.1,
        concentricity=0.1,
        cvresult_id=context.id
    )
    session.add(cvresult)
    session.commit()

    pickledata=[897.66, 899.3, 900.94, 902.58, 904.22, 905.86, 907.5, 909.14, 910.78, 912.42, 914.06, 915.7, 917.34,
                918.98, 920.62, 922.26, 923.9, 925.53, 927.17, 928.81, 930.45, 932.09, 933.73, 935.37, 937.01, 938.65,
                940.29, 941.92, 943.56, 945.2, 946.84, 948.48, 950.12, 951.75, 953.39, 955.03, 956.67, 958.31, 959.94,
                961.58, 963.22, 964.86, 966.49, 968.13, 969.77, 971.41, 973.04, 974.68, 976.32, 977.95, 979.59, 981.23,
                982.86, 984.5, 986.14, 987.77, 989.41, 991.05, 992.68, 994.32, 995.95, 997.59, 999.23, 1000.86, 1002.5,
                1004.13, 1005.77, 1007.4, 1009.04, 1010.67, 1012.31, 1013.94, 1015.58, 1017.21, 1018.85, 1020.48,
                1022.12, 1023.75, 1025.39, 1027.02, 1028.65, 1030.29, 1031.92, 1033.56, 1035.19, 1036.82, 1038.46,
                1040.09, 1041.72, 1043.36, 1044.99, 1046.62, 1048.26, 1049.89, 1051.52, 1053.15, 1054.79, 1056.42,
                1058.05, 1059.68, 1061.32, 1062.95, 1064.58, 1066.21, 1067.84, 1069.47, 1071.11, 1072.74, 1074.37,
                1076.0, 1077.63, 1079.26, 1080.89, 1082.52, 1084.15, 1085.78, 1087.41, 1089.04, 1090.67, 1092.3,
                1093.93, 1095.56, 1097.19, 1098.82, 1100.45, 1102.08, 1103.71, 1105.34, 1106.97, 1108.6, 1110.22,
                1111.85, 1113.48, 1115.11, 1116.74, 1118.37, 1119.99, 1121.62, 1123.25, 1124.88, 1126.5, 1128.13,
                1129.76, 1131.38, 1133.01, 1134.64, 1136.26, 1137.89, 1139.52, 1141.14, 1142.77, 1144.4, 1146.02,
                1147.65, 1149.27, 1150.9, 1152.52, 1154.15, 1155.77, 1157.4, 1159.02, 1160.65, 1162.27, 1163.9, 1165.52,
                1167.14, 1168.77, 1170.39, 1172.02, 1173.64, 1175.26, 1176.89, 1178.51, 1180.13, 1181.75, 1183.38,
                1185.0, 1186.62, 1188.24, 1189.87, 1191.49, 1193.11, 1194.73, 1196.35, 1197.97, 1199.59, 1201.22,
                1202.84, 1204.46, 1206.08, 1207.7, 1209.32, 1210.94, 1212.56, 1214.18, 1215.8, 1217.42, 1219.04,
                1220.66, 1222.27, 1223.89, 1225.51, 1227.13, 1228.75, 1230.37, 1231.99, 1233.6, 1235.22, 1236.84,
                1238.46, 1240.07, 1241.69, 1243.31, 1244.92, 1246.54, 1248.16, 1249.77, 1251.39, 1253.01, 1254.62,
                1256.24, 1257.85, 1259.47, 1261.08, 1262.7, 1264.31, 1265.93, 1267.54, 1269.16, 1270.77, 1272.38,
                1274.0, 1275.61, 1277.23, 1278.84, 1280.45, 1282.06, 1283.68, 1285.29, 1286.9, 1288.51, 1290.13,
                1291.74, 1293.35, 1294.96, 1296.57, 1298.18, 1299.79, 1301.41, 1303.02, 1304.63, 1306.24, 1307.85,
                1309.46, 1311.07, 1312.68, 1314.29, 1315.89, 1317.5, 1319.11, 1320.72, 1322.33, 1323.94, 1325.55,
                1327.15, 1328.76, 1330.37, 1331.98, 1333.58, 1335.19, 1336.8, 1338.4, 1340.01, 1341.62, 1343.22,
                1344.83, 1346.43, 1348.04, 1349.64, 1351.25, 1352.85, 1354.46, 1356.06, 1357.67, 1359.27, 1360.87,
                1362.48, 1364.08, 1365.69, 1367.29, 1368.89, 1370.49, 1372.1, 1373.7, 1375.3, 1376.9, 1378.5, 1380.11,
                1381.71, 1383.31, 1384.91, 1386.51, 1388.11, 1389.71, 1391.31, 1392.91, 1394.51, 1396.11, 1397.71,
                1399.31, 1400.9, 1402.5, 1404.1, 1405.7, 1407.3, 1408.9, 1410.49, 1412.09, 1413.69, 1415.28, 1416.88,
                1418.48, 1420.07, 1421.67, 1423.27, 1424.86, 1426.46, 1428.05, 1429.65, 1431.24, 1432.84, 1434.43,
                1436.02, 1437.62, 1439.21, 1440.8, 1442.4, 1443.99, 1445.58, 1447.18, 1448.77, 1450.36, 1451.95,
                1453.54, 1455.13, 1456.73, 1458.32, 1459.91, 1461.5, 1463.09, 1464.68, 1466.27, 1467.86, 1469.45,
                1471.04, 1472.62, 1474.21, 1475.8, 1477.39, 1478.98, 1480.56, 1482.15, 1483.74, 1485.33, 1486.91,
                1488.5, 1490.09, 1491.67, 1493.26, 1494.84, 1496.43, 1498.01, 1499.6, 1501.18, 1502.77, 1504.35,
                1505.94, 1507.52, 1509.1, 1510.69, 1512.27, 1513.85, 1515.43, 1517.02, 1518.6, 1520.18, 1521.76,
                1523.34, 1524.92, 1526.5, 1528.08, 1529.66, 1531.24, 1532.82, 1534.4, 1535.98, 1537.56, 1539.14,
                1540.72, 1542.3, 1543.88, 1545.45, 1547.03, 1548.61, 1550.18, 1551.76, 1553.34, 1554.91, 1556.49,
                1558.07, 1559.64, 1561.22, 1562.79, 1564.37, 1565.94, 1567.51, 1569.09, 1570.66, 1572.23, 1573.81,
                1575.38, 1576.95, 1578.52, 1580.1, 1581.67, 1583.24, 1584.81, 1586.38, 1587.95, 1589.52, 1591.09,
                1592.66, 1594.23, 1595.8, 1597.37, 1598.94, 1600.51, 1602.08, 1603.65, 1605.21, 1606.78, 1608.35,
                1609.91, 1611.48, 1613.05, 1614.61, 1616.18, 1617.74, 1619.31, 1620.87, 1622.44, 1624.0, 1625.57,
                1627.13, 1628.7, 1630.26, 1631.82, 1633.38, 1634.95, 1636.51, 1638.07, 1639.63, 1641.19, 1642.76,
                1644.32, 1645.88, 1647.44, 1649.0, 1650.56, 1652.12, 1653.67, 1655.23, 1656.79, 1658.35, 1659.91,
                1661.47, 1663.02, 1664.58, 1666.14, 1667.69, 1669.25, 1670.81, 1672.36, 1673.92, 1675.47, 1677.03,
                1678.58, 1680.13, 1681.69, 1683.24, 1684.79, 1686.35, 1687.9, 1689.45, 1691.0, 1692.56, 1694.11,
                1695.66, 1697.21, 1698.76, 1700.31, 1701.86, 1703.41, 1704.96, 1706.51, 1708.06, 1709.61, 1711.15,
                1712.7, 1714.25, 1715.8, 1717.34]

    opresult = OPResult(
        waves= pickle.dumps(pickledata),
        powers=pickle.dumps(pickledata),
        opresult_id=context.id
    )

    session.add(opresult)
    session.commit()

